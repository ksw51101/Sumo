<!DOCTYPE html>

<html lang="en">
<head>
  <title>TraCI/Interfacing_TraCI_from_Python - Eclipse SUMO - Simulation of Urban Mobility</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="../sumo.css">
  <link rel="license" href=
  "http://creativecommons.org/licenses/by-sa/3.0/">
</head>

<body id="bmission">
  <div id="container">
    <div id="logo" style="text-align:left">
      <img src="../logo.png" width="374" height="128"
      alt="SUMO-Simulation of Urban Mobility" style=
      "float:left; margin-left:10px; margin-right:20px;">
      <div id="logo_text1">&nbsp;</div>
      <div id="logo_text2">&nbsp;</div>
    </div>

    <div id="subsMenu">
      <ul>
        <li class="sub"><a href=
        "http://sumo.dlr.de/">Home</a></li>

        <li class="sub"><a href="../Downloads.html">Download</a></li>

        <li class="sub"><a href="../index.html">Documentation</a></li>

        <li class="sub"><a href=
        "http://sumo.dlr.de/wiki/">Wiki</a></li>

        <li class="sub"><a href=
        "https://github.com/eclipse/sumo/issues">Issue Tracker</a></li>

        <li class="sub"><a href="../Contact.html">Contact</a></li>

        <li class="sub"><a href=
        "https://github.com/eclipse/sumo">GitHub Project</a></li>
      </ul>
    </div>

    <div id="nav">
      <div id="step1">
        <h3>User</h3>
        <ul>
        <!-- nav begins --> <li>Introduction</li>
<li style="list-style: none; display: inline"><ul>
  <li><a href="../Sumo_at_a_Glance.html">The traffic simulation SUMO</a></li>
</ul></li>
  <li>Basic Usage</li>
<li style="list-style: none; display: inline"><ul>
  <li><a href="../Basics/Notation.html">Notation in this Documentation</a></li>
  <li><a href="../Basics/Basic_Computer_Skills.html">Needed, basic Computer Skills</a></li>
  <li><a href="../Installing.html">Installing SUMO</a></li>
  <li><a href="../Basics/Using_the_Command_Line_Applications.html">Using SUMO Command Line Applications</a></li>
  <li><a href="../Tutorials.html">Tutorials</a></li>
  <li><a href="../XMLValidation.html">Validating application inputs</a></li>
</ul></li>
  <li>Network Building</li>
<li style="list-style: none; display: inline"><ul>
  <li><a href="../Networks/SUMO_Road_Networks.html">SUMO Road Networks</a></li>
  <li><a href="../Networks/Abstract_Network_Generation.html">Abstract networks generation</a></li>
  <li><a href="../NETCONVERT.html">NETCONVERT</a></li>
<li style="list-style: none; display: inline"><ul>
   <li><a href="../Networks/Building_Networks_from_own_XML-descriptions.html">Defining own networks using XML</a></li>
   <li><a href="../Networks/Import.html">Importing non-SUMO networks</a></li>
<li style="list-style: none; display: inline"><ul>
    <li><a href="../Networks/Import/OpenStreetMap.html">from OpenStreetMap</a></li>
<li style="list-style: none; display: inline"><ul>
     <li><a href="../Networks/Import/OpenStreetMap.html#3-click_scenario_generation">3-Click Scenario Generator</a></li>
</ul></li>
    <li><a href="../Networks/Import/VISUM.html">from VISUM</a></li>
    <li><a href="../Networks/Import/Vissim.html">from Vissim</a></li>
    <li><a href="../Networks/Import/OpenDRIVE.html">from OpenDRIVE</a></li>
    <li><a href="../Networks/Import/MATsim.html">from MATsim</a></li>
    <li><a href="../Networks/Import/ArcView.html">from ArcView (shapefiles)</a></li>
    <li><a href="../Networks/Import/DlrNavteq.html">from DlrNavTeq</a></li>
    <li><a href="../Networks/Import/RoboCup.html">from Robocup Simulation League</a></li>
</ul></li>
   <li><a href="../Networks/Import/SUMO_Road_Networks.html">Importing SUMO networks</a></li>
   <li><a href="../Simulation/Motorways.html#Building_a_network_for_motorway_simulation">Building networks for motorway simulation</a></li>
   <li><a href="../Simulation/Pedestrians.html#Building_a_network_for_pedestrian_simulation">Building networks for pedestrian simulation</a></li>
   <li><a href="../Networks/Further_Options.html">Further NETCONVERT options</a></li>
   <li><a href="../Networks/Further_Outputs.html">Additional output</a></li>
</ul></li>
  <li><a href="../NETEDIT.html">Creating and modifying networks with NETEDIT</a></li>
  <li><a href="../Networks/Elevation.html">Including elevation data</a></li>
  <li><a href="../Geo-Coordinates.html">Geo-Coordinates</a></li>
</ul></li>
  <li>Demand Modelling</li>
<li style="list-style: none; display: inline"><ul>
  <li><a href="../Demand/Introduction_to_demand_modelling_in_SUMO.html">Introduction to SUMO Demand Modelling</a></li>
  <li><a href="../Definition_of_Vehicles,_Vehicle_Types,_and_Routes.html">Definition of Vehicles, Vehicle Types, and Routes</a></li>
  <li><a href="../Simulation/Public_Transport.html">Simulation of public transport</a></li>
  <li><a href="../Specification/Persons.html">Simulation of individual persons and trip chains</a></li>
  <li><a href="../Specification/Logistics.html">Simulation of logistics</a></li>
  <li><a href="../Demand/Shortest_or_Optimal_Path_Routing.html">Shortest or Optimal Path Routing</a></li>
  <li><a href="../IntermodalRouting.html">Intermodal Routing</a></li>
  <li><a href="../Demand/Automatic_Routing_.html">Routing in the Simulation</a></li>
  <li><a href="../Demand/Dynamic_User_Assignment.html">Computing Dynamic User Assignment</a></li>
  <li><a href="../Simulation/Pedestrians.html#Generating_pedestrian_demand">Generating pedestrian traffic demand</a></li>
  <li><a href="../Tools/Misc.html#createVehTypeDistributions.py">Generate a vehicle type distribution to model the fleet</a></li>
</ul></li>
  <li>Data sources for demand generation</li>
<li style="list-style: none; display: inline"><ul>
  <li><a href="../Demand/Importing_O/D_Matrices.html">Importing O/D Matrices</a></li>
<li style="list-style: none; display: inline"><ul>
   <li><a href="../Demand/Further_Ways_to_import_VISUM_Demand_Definitions.html">Other VISUM Demand Importers</a></li>
   <li><a href="../Demand/Further_Ways_to_import_Vissim_Demand_Definitions.html">Other Vissim Demand Importers</a></li>
</ul></li>
  <li><a href="../Demand/Routes_from_Observation_Points.html">Routes from Observation Points</a></li>
  <li><a href="../Demand/Routing_by_Turn_Probabilities.html">Routing by Turn Probabilities</a></li>
  <li><a href="../Demand/Activity-based_Demand_Generation.html">Activity-based Demand Generation</a></li>
  <li><a href="../Tools/Trip.html#randomTrips.py">Random Trips</a></li>
  <li><a href="../Tools/Import/OSM.html#osmWebWizard.py">Multi-modal random traffic</a></li>
</ul></li>
  <li>Simulation</li>
<li style="list-style: none; display: inline"><ul>
  <li><a href="../Simulation/Basic_Definition.html">Basic Definition</a></li>
  <li><a href="../Simulation/Output.html">Simulation output</a></li>
  <li><a href="../TraCI.html">TraCI (On-line Interaction)</a></li>
  <li><a href="../Simulation/SaveAndLoad.html">Saving and Loading Simulation State</a></li>
</ul></li>
  <li> Traffic Management and Other Structures </li>
<li style="list-style: none; display: inline"><ul>
  <li><a href="../Simulation/Traffic_Lights.html">Traffic Lights</a></li>
  <li><a href="../Simulation/Public_Transport.html">Public Transport</a></li>
  <li><a href="../Simulation/Variable_Speed_Signs.html">Variable Speed Signs</a></li>
  <li><a href="../Simulation/Rerouter.html">Rerouter / Alternative Route Signage</a></li>
  <li><a href="../Simulation/Vaporizer.html">Vaporizer</a></li>
  <li><a href="../Simulation/Calibrator.html">Dynamic calibration of flow and speed</a></li>
  <li><a href="../Simulation/ParkingArea.html">Parking areas</a></li>
</ul></li>
  <li> Traffic Modes </li>
<li style="list-style: none; display: inline"><ul>
  <li><a href="../Simulation/Pedestrians.html">Pedestrian simulation</a></li>
  <li><a href="../Simulation/Bicycles.html">Bicycle simulation</a></li>
  <li><a href="../Simulation/Railways.html">Railway simulation</a></li>
  <li><a href="../Simulation/Waterways.html">Waterway simulation</a></li>
</ul></li>
  <li> Additional Features </li>
<li style="list-style: none; display: inline"><ul>
  <li><a href="../Models/Emissions.html">Emissions</a></li>
  <li><a href="../Models/Electric.html">Electric Vehicles</a></li>
  <li><a href="../Specification/Logistics.html">Logistics</a></li>
  <li><a href="../Simulation/GenericParameters.html">Generic Parameters</a></li>
  <li><a href="../Simulation/Shapes.html">Shapes Visualisation</a></li>
  <li><a href="../Simulation/Bluetooth.html">Wireless Device Detection</a></li>
  <li><a href="../Simulation/Emergency.html">Emergency Vehicles</a></li>
</ul></li>
  <li> Model details </li>
<li style="list-style: none; display: inline"><ul>
  <li><a href="../Simulation/VehicleSpeed.html">Vehicle speed</a></li>
  <li><a href="../Simulation/VehicleInsertion.html">Vehicle insertion</a></li>
  <li><a href="../Simulation/VehiclePermissions.html">Vehicle permissions (access restrictions)</a></li>
  <li><a href="../Simulation/Intersections.html">Intersection dynamics</a></li>
  <li><a href="../Simulation/Randomness.html">Randomness</a></li>
  <li><a href="../Simulation/Routing.html">Routing and Re-routing</a></li>
  <li><a href="../Simulation/SublaneModel.html">Sublane Model</a></li>
  <li><a href="../Simulation/OppositeDirectionDriving.html">Opposite Direction Driving</a></li>
  <li><a href="../Simulation/Safety.html">Safety</a></li>
  <li><a href="../Simulation/Meso.html">Mesoscopic model</a></li>
</ul></li>
  <li> Common Problems </li>
<li style="list-style: none; display: inline"><ul>
  <li><a href="../Simulation/Why_Vehicles_are_teleporting.html">Why Vehicles are teleporting</a></li>
  <li><a href="../FAQ.html#The_simulation_has_lots_of_jams.2Fdeadlocks._What_can_I_do.3F">Unexpected jamming</a></li>
  <li><a href="../FAQ.html#Why_do_the_vehicles_perform_unexpected_lane-changing_maneuvers.3F">Unexpected lane-changing maneuvers?</a></li>
  <li><a href="../FAQ.html#How_do_I_get_high_flows.2Fvehicle_densities.3F">How to get high flows?</a></li>
</ul></li>
  <li><a href="../Tools/Main.html">Additional Tools</a></li>
<li style="list-style: none; display: inline"><ul>
  <li><a href="../Tools/Main.html">Tool index</a></li>
  <li><a href="../Tools/Import/OSM.html#osmWebWizard.py">osmWebWizard</a></li>
  <li><a href="../TraCI/Interfacing_TraCI_from_Python.html">TraCI/Interfacing_TraCI_from_Python</a></li>
  <li><a href="../Tools/Sumolib.html">Reading SUMO networks and outputs with Python (sumolib)</a></li>
  <li><a href="../Tools/Xml.html">Tools for converting SUMO outputs to CSV/Spreadsheet</a></li>
  <li><a href="../Tools/TraceExporter.html">Exporting mobility Traces (traceExporter)</a></li>
  <li><a href="../Tools/Net.html#netdiff.py">Determining the differences between two networks</a></li>
  <li><a href="../Tools/Visualization.html">Tools/Visualization</a></li>
</ul></li>
  <li>Theory</li>
<li style="list-style: none; display: inline"><ul>
  <li><a href="../Theory/Traffic_Simulations.html">Traffic simulations in general</a></li>
</ul></li>
  <li>Application Manuals</li>
<li style="list-style: none; display: inline"><ul>
  <li><a href="../SUMO.html">SUMO</a></li>
  <li><a href="../SUMO-GUI.html">SUMO-GUI</a></li>
  <li><a href="../NETCONVERT.html">NETCONVERT</a></li>
  <li><a href="../NETEDIT.html">NETEDIT</a></li>
  <li><a href="../NETGENERATE.html">NETGENERATE</a></li>
  <li><a href="../OD2TRIPS.html">OD2TRIPS</a></li>
  <li><a href="../DUAROUTER.html">DUAROUTER</a></li>
  <li><a href="../JTRROUTER.html">JTRROUTER</a></li>
  <li><a href="../DFROUTER.html">DFROUTER</a></li>
  <li><a href="../MAROUTER.html">MAROUTER</a></li>
  <li><a href="../POLYCONVERT.html">POLYCONVERT</a></li>
  <li><a href="../ACTIVITYGEN.html">ACTIVITYGEN</a></li>
  <li><a href="../Tools/Emissions.html">EMISSIONSMAP</a></li>
  <li><a href="../Tools/Emissions.html">EMISSIONSDRIVINGCYCLE</a></li>
</ul></li>
  <li>Appendices</li>
<li style="list-style: none; display: inline"><ul>
  <li><a href="../ChangeLog.html">ChangeLog</a></li>
  <li><a href="../Other/Glossary.html">Glossary</a></li>
  <li><a href="../FAQ.html">FAQ</a></li>
  <li><a href="../Tools/Main.html">Additional Tools</a></li>
  <li><a href="../Other/File_Extensions.html">Known File Extensions</a></li>
</ul></li>
<!-- nav ends -->
        </ul>
      </div>

      <div id="step2">
        <h3>Further Resources</h3>

        <ul>
          <li><a href="../Data/Networks.html">Example Networks</a></li>

          <li><a href="../Data/Scenarios.html">Example Scenarios</a></li>

          <li><a href="../Data/Traffic_Data.html">Traffic Data</a></li>
        </ul>
      </div>

      <div id="step3">
        <h3>Developer</h3>

        <ul>
          <li><a href="../Developer/Main.html">Developer Docs</a></li>

          <li><a href="http://sumo.dlr.de/daily/">Daily Test Status</a></li>

          <li><a href="../../doxygen/">Doxygen Documentation</a></li>

          <li>Python Modules Documentation</li>

          <li style="list-style: none; display: inline">
            <ul>
              <li><a href="../../pydoc/traci.html">traci</a></li>

              <li><a href="../../pydoc/sumolib.html">sumolib</a></li>
            </ul>
          </li>

          <li>Java Modules Documentation</li>

          <li style="list-style: none; display: inline">
            <ul>
              <li><a href="../../javadoc/traas/">TraaS</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>

    <div id="content">
      <a id="top"></a>
			<div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">TraCI/Interfacing TraCI from Python</h1>			<div id="bodyContent" class="mw-body-content">
				<div id="siteSub" class="noprint">generated on 2019-04-16 00:19:10.244801 from <a href="https://sumo.dlr.de/wiki/TraCI/Interfacing_TraCI_from_Python">the wiki page for TraCI/Interfacing_TraCI_from_Python</a> for SUMO 1.2.0</div>				<div id="contentSub"></div>
								
				
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><p>The <a href="../TraCI.html#TraCI_Commands" title="TraCI">TraCI</a> commands are split into the 13 domains gui, lane, poi, simulation, trafficlight, vehicletype, edge, inductionloop, junction, multientryexit, polygon, route, person and vehicle, which correspond to individual modules. For a detailed list of available functions see the <a rel="nofollow" class="external text" href="../../pydoc/traci.html">pydoc generated documentation</a>. The source code can be found at <a rel="nofollow" class="external autonumber" href="https://github.com/eclipse/sumo/tree/master/tools/traci">[1]</a>
</p>
<div style="background: #ffcc44; padding: .5em; border: 1px dashed #ff8800; margin-right:10px; margin-left:10px;"><b>Caution:</b><br />Due to the way the python client code is organized, code completion does not work in popular development environments. E.g. the vehicle module is accessed via <i>traci.vehicle</i> but the code resides in file <i>traci/_vehicle.py</i>.</div>
<div id="toc" class="toc"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none" /><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#importing_traci_in_a_script"><span class="tocnumber">1</span> <span class="toctext">importing <b>traci</b> in a script</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#First_Steps"><span class="tocnumber">2</span> <span class="toctext">First Steps</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Subscriptions"><span class="tocnumber">3</span> <span class="toctext">Subscriptions</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Context_Subscriptions"><span class="tocnumber">4</span> <span class="toctext">Context Subscriptions</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Context_Subscription_Filters"><span class="tocnumber">5</span> <span class="toctext">Context Subscription Filters</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Adding_a_StepListener"><span class="tocnumber">6</span> <span class="toctext">Adding a StepListener</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Controlling_parallel_simulations_from_the_same_TraCI_script"><span class="tocnumber">7</span> <span class="toctext">Controlling parallel simulations from the same TraCI script</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Controlling_the_same_simulation_from_multiple_clients"><span class="tocnumber">8</span> <span class="toctext">Controlling the same simulation from multiple clients</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Embedded_Python"><span class="tocnumber">9</span> <span class="toctext">Embedded Python</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#Linux"><span class="tocnumber">9.1</span> <span class="toctext">Linux</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Windows"><span class="tocnumber">9.2</span> <span class="toctext">Windows</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="#Additional_Functions"><span class="tocnumber">10</span> <span class="toctext">Additional Functions</span></a></li>
<li class="toclevel-1 tocsection-13"><a href="#Pitfalls_and_Solutions"><span class="tocnumber">11</span> <span class="toctext">Pitfalls and Solutions</span></a>
<ul>
<li class="toclevel-2 tocsection-14"><a href="#Debugging_a_TraCI_session_on_Linux"><span class="tocnumber">11.1</span> <span class="toctext">Debugging a TraCI session on Linux</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15"><a href="#Usage_Examples"><span class="tocnumber">12</span> <span class="toctext">Usage Examples</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#Run_a_simulation_until_all_vehicles_have_arrived"><span class="tocnumber">12.1</span> <span class="toctext">Run a simulation until all vehicles have arrived</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Add_trips_.28incomplete_routes.29_dynamically"><span class="tocnumber">12.2</span> <span class="toctext">Add trips (incomplete routes) dynamically</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#coordinate_transformations"><span class="tocnumber">12.3</span> <span class="toctext">coordinate transformations</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Retrieve_the_timeLoss_for_all_vehicles_currently_in_the_network"><span class="tocnumber">12.4</span> <span class="toctext">Retrieve the timeLoss for all vehicles currently in the network</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-20"><a href="#Further_Resources"><span class="tocnumber">13</span> <span class="toctext">Further Resources</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="importing_traci_in_a_script">importing <b>traci</b> in a script</span></h2>
<p>To use the library, the <i><b>&lt;SUMO_HOME&gt;</b></i>/tools directory must be on the python load path. This is typically done with a stanza like this:
</p>
<pre> import os, sys
 if 'SUMO_HOME' in os.environ:
     tools = os.path.join(os.environ['SUMO_HOME'], 'tools')
     sys.path.append(tools)
 else:   
     sys.exit("please declare environment variable 'SUMO_HOME'")
</pre>
<p>This assumes that the <a href="../Basics/Basic_Computer_Skills.html#Additional_Environment_Variables" title="Basics/Basic Computer Skills">environment variable <b>SUMO_HOME</b></a> is set before running the script. Alternatively, you can declare the path to <i>sumo/tools</i> directly as in the line
</p>
<pre> sys.path.append(os.path.join('c:', os.sep, 'whatever', 'path', 'to', 'sumo', 'tools'))
</pre>
<h2><span class="mw-headline" id="First_Steps">First Steps</span></h2>
<p>In general it is very easy to interface with SUMO from Python (the following example is a modification of <a href="../Tutorials/TraCI4Traffic_Lights.html" title="Tutorials/TraCI4Traffic Lights">tutorial/traci_tls</a>):
</p><p>First you compose the command line to start either <a href="../SUMO.html" title="SUMO">SUMO</a> or <a href="../SUMO-GUI.html" title="SUMO-GUI">SUMO-GUI</a> (leaving out the option <span style="color: #111144; font-weight: bold; white-space: pre;">--remote-port</span> which was needed before 0.28.0):
</p>
<pre>sumoBinary = "/path/to/sumo-gui"
sumoCmd = [sumoBinary, "-c", "yourConfiguration.sumocfg"]
</pre>
<p>Then you start the simulation and connect to it with your script:
</p>
<pre>import traci
traci.start(sumoCmd) 
step = 0
while step &lt; 1000:
   traci.simulationStep()
   if traci.inductionloop.getLastStepVehicleNumber("0") &gt; 0:
       traci.trafficlight.setRedYellowGreenState("0", "GrGr")
   step += 1

traci.close()
</pre>
<p>After connecting to the simulation, you can emit various commands and execute simulation steps until you want to finish by
closing the connection. by default the close command will wait until the sumo process really finishes. You can disable this by calling
</p>
<pre>traci.close(False)
</pre>
<h2><span class="mw-headline" id="Subscriptions">Subscriptions</span></h2>
<p>Subscriptions can be thought of as a batch mode for retrieving variables. Instead of asking for the same variables over and over again, you can retrieve the values of interest automatically after each time step.
TraCI subscriptions are handled on a per module basis. That is you can ask the module for the result of all current subscriptions after each time step. In order to subscribe for variables you need to know their variable ids which can be looked up in the traci/constants.py file.
</p>
<pre>import traci
import traci.constants as tc

traci.start(["sumo", "-c", "my.sumocfg"]) 
traci.vehicle.subscribe(vehID, (tc.VAR_ROAD_ID, tc.VAR_LANEPOSITION))
print(traci.vehicle.getSubscriptionResults(vehID))
for step in range(3):
   print("step", step)
   traci.simulationStep()
   print(traci.vehicle.getSubscriptionResults(vehID))
traci.close()
</pre>
<p>The values retrieved are always the ones from the last time step, it is not possible to retrieve older values.
</p>
<h2><span class="mw-headline" id="Context_Subscriptions">Context Subscriptions</span></h2>
<p>Context subscriptions work like subscriptions in that they retrieve a list of variables automatically for every simulation stop. However, the do so by setting a reference object and a range and then retrieving variables for all objects of a given type within range of the reference object.
</p><p>TraCI context subscriptions are handled on a per module basis. That is you can ask the module for the result of all current subscriptions after each time step. In order to subscribe for variables you need to the domain id of the objects that shall be retrieved and the variable ids which can be looked up in the traci/constants.py file.
The domain id always has the form CMD_GET_&lt;DOMAIN&gt;_VARIABLE.
The following code retrieves all vehicle speeds and waiting times within range (42m) of a junction (the vehicle ids are retrieved implicitly).
</p>
<pre>import traci
import traci.constants as tc

traci.start(["sumo", "-c", "my.sumocfg"]) 
traci.junction.subscribeContext(junctionID, tc.CMD_GET_VEHICLE_VARIABLE, 42, [tc.VAR_SPEED, tc.VAR_WAITING_TIME])
print(traci.junction.getContextSubscriptionResults(junctionID))
for step in range(3):
   print("step", step)
   traci.simulationStep()
   print(traci.junction.getContextSubscriptionResults(junctionID))
traci.close()
</pre>
<p>The values retrieved are always the ones from the last time step, it is not possible to retrieve older values.
</p>
<h2><span class="mw-headline" id="Context_Subscription_Filters">Context Subscription Filters</span></h2>
<p>For vehicle-to-vehicle context subscriptions (i.e., context subscriptions, whose reference object is a vehicle and whose requested context objects are vehicles as well) it is possible to request additional filters to be applied already on the server side. The general procedure is to equip a requested context subscription with the filter directly after the call to <code>subscribeContext()</code> by a succesive call to <code>addSubscriptionFilter&lt;FILTER_ID&gt;()</code> as for instance in the following snippet:
</p>
<pre>traci.vehicle.subscribeContext("ego", tc.CMD_GET_VEHICLE_VARIABLE, 0.0, [tc.VAR_SPEED])
traci.vehicle.addSubscriptionFilterLanes(lanes, noOpposite=True, downstreamDist=100, upstreamDist=50)
</pre>
<p>The first line requests a context subscription for the speed of vehicles in the neighborhood of the reference vehicle with the ID <code>"ego"</code>. The range of the context subscription (which refers to the radial context region of the usual subscription mechanism) can be set equal to <code>0.0</code>, since it is be overridden by the selective values of <code>downstreamDist</code> and <code>upstreamDist</code>, respectively, given to the call of <code>addSubscriptionFilterLanes()</code> in the second line. The call to <code>addSubscriptionFilter&lt;FILTER_NAME&gt;()</code> automatically takes effect on the last issued context subscription, which has to be of the vehicle-to-vehicle form for a successful application.
</p><p>The following filter types are available:
</p>
<ul><li>Lanes: Return surrounding vehicles on lanes specified relatively to the reference vehicle</li>
<li>CFManeuver: Return leader and follower on the reference vehicle's lane</li>
<li>LCManeuver: Return leader and follower on the reference vehicle's lane and neighboring lane(s)</li>
<li>Turn: Return conflicting vehicles on upcoming junctions along the vehicle's route</li>
<li>VType: Only return vehicles of the specified vTypes</li>
<li>VClass: Only return vehicles of the specified vClasses</li></ul>
<p>See the <a rel="nofollow" class="external text" href="../../pydoc/traci._vehicle.html#VehicleDomain-addSubscriptionFilterCFManeuver">pydoc documentation</a> for detailed specifications.
</p>
<h2><span class="mw-headline" id="Adding_a_StepListener">Adding a StepListener</span></h2>
<p>Often a function needs to be called each time when traci.simulationStep() is called, to let this happen automatically (always <i>after</i> each call to simulationStep()) it is possible to add a StepListener object 'listener' (more precisely an instance of a subclass of traci.StepListener) i.e.
</p>
<pre> class ExampleListener(traci.StepListener):
    def step(self, t=0):
        # do something at every simulaton step
        print("ExampleListener called at time %s ms."&#160;% t)
        # indicate that the step listener should stay active in the next step
        return True
       
 listener = ExampleListener()
 traci.addStepListener(listener)
</pre>
<div style="background: #ffcc44; padding: .5em; border: 1px dashed #ff8800; margin-right:10px; margin-left:10px;"><b>Caution:</b><br />A TraCI StepListener cannot be used in the case that one traci client controls several SUMO-instances.</div>
<h2><span class="mw-headline" id="Controlling_parallel_simulations_from_the_same_TraCI_script">Controlling parallel simulations from the same TraCI script</span></h2>
<p>The TraCI python library can be used to control multiple simulations at the same time with a single script.
The function <i>traci.start()</i> has an optional label argument which allows you to call it multiple times with different simulation instances and labels. The function <i>traci.switch()</i> can then be used to switch to any of the initialized labels:
</p>
<pre> traci.start(["sumo", "-c", "sim1.sumocfg"], label="sim1")
 traci.start(["sumo", "-c", "sim2.sumocfg"], label="sim2")
 traci.switch("sim1")
 traci.simulationStep() # run 1 step for sim1
 traci.switch("sim2")
 traci.simulationStep() # run 1 step for sim2
</pre>
<p>If you prefer a more object oriented approach you can also use connection objects to communicate with the simulation. They have the same interface as the static <i>traci.</i> calls but you will still need to start the simulation manually for them:
</p>
<pre> traci.start(["sumo", "-c", "sim1.sumocfg"], label="sim1")
 traci.start(["sumo", "-c", "sim2.sumocfg"], label="sim2")
 conn1 = traci.getConnection("sim1")
 conn2 = traci.getConnection("sim2")
 conn1.simulationStep() # run 1 step for sim1
 conn2.simulationStep() # run 1 step for sim2
</pre>
<h2><span class="mw-headline" id="Controlling_the_same_simulation_from_multiple_clients">Controlling the same simulation from multiple clients</span></h2>
<p>To connect with multiple clients, the number of clients must be known in advance and specified with sumo option <span style="color: #111144; font-weight: bold; white-space: pre;">--num-clients <a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;INT&gt;</i></a></span>.
Also, the connection port must be known to all clients.
After deciding on a port it can be made available to the clients via arguments or configuration files.
A free port can be obtained by
</p>
<pre>from sumolib.miscutils import getFreeSocketPort
port = sumolib.miscutils.getFreeSocketPort()
</pre>
<p>One client may use method <i>traci.start()</i> to start the simulation and connect to it at the same time while the other client only needs to connect.
After establishing client order, each client must continuously call <i>simulationStep</i> to allow the simulation to advance:
</p>
<pre>#client1
# PORT = int(sys.argv[1]) # example
traci.start(["sumo", "-c", "sim.sumocfg", "--num-clients", "2"], port=PORT)
traci.setOrder(1) # number can be anything
while traci.simulation.getMinExpectedNumber() &gt; 0: 
   traci.simulationStep()
   # more traci commands
traci.close(
</pre>
<pre># client2
# PORT = int(sys.argv[1]) # example
traci.init(PORT)
traci.setOrder(2) # number can be anything as long as each client gets its own number
while traci.simulation.getMinExpectedNumber() &gt; 0: 
   traci.simulationStep()
   # more traci commands
traci.close()
</pre>
<h2><span class="mw-headline" id="Embedded_Python">Embedded Python</span></h2>
<p>As an experimental feature, it is also possible to link SUMO with python directly and have the scripts executed in SUMO. The syntax is completely
the same, except that you leave out the calls to init and close and you need to start sumo with the option --python-script. This feature is considered deprecated and will be replaced by <a href="../Libsumo.html" title="Libsumo">libsumo</a>. It does currently <i>not</i> work with the GUI version of sumo.
</p><p>Since the feature is not well tested yet, you need to enable embedded python explicitly when building SUMO (it is <i>not</i> enabled in the release versions and the nightly build). In order to do so, follow the instructions below
</p>
<h3><span class="mw-headline" id="Linux">Linux</span></h3>
<ul><li>install the python devel package files</li>
<li>call configure using the --with-python option</li>
<li>make &amp;&amp; make install as usual</li></ul>
<h3><span class="mw-headline" id="Windows">Windows</span></h3>
<ul><li>make sure python is installed and is in your PATH</li>
<li>call tools\build\pythonPropsMSVC.py to generate / modify the build\msvc10\config.props file</li>
<li>build the Win32 Release version as usual</li>
<li>the debug build is somewhat more involved and is disabled by default, the following instructions are <a rel="nofollow" class="external text" href="http://upp-mirror.googlecode.com/svn-history/r3552/trunk/bazaar/Py/install.txt">taken from here</a>
<ul><li>download the python source package fitting your python version</li>
<li>open the pcbuild.sln in the PCbuild subdir with Visual Studio</li>
<li>do the Win32 Debug build for python, it will have lots of errors but the main parts (hopefully) succeed</li>
<li>from the PCbuild dir copy
<ul><li>python27_d.dll to the Python dir (something like C:\Python27)</li>
<li>python27_d.lib, python27_d.pdb, python27_d.exp to the libs dir (C:\Python27\libs)</li>
<li>every *_d.pyd to the DLLs dir (C:\Python27\DLLs)</li></ul></li>
<li>enable the python debug build by editing build\msvc10\Win32.props</li>
<li>now you can do the Win32 Debug build for SUMO</li></ul></li></ul>
<div style="background: #ffffdd; padding: .5em; border: 1px dashed #ffcc44; margin-right:10px; margin-left:10px;"><b>Note:</b><br />There is no easy way to link the SUMO Debug build against a release version of Python (as it is possible with other libraries). If you just need SUMO with debugging symbols, and don't want to build the python debug lib, use the Fastbuild configuration.</div>
<p>Earlier versions of Visual Studio and 64bit build are currently not directly supported (but the interested programmer should be able to modify the files accordingly).
</p>
<h2><span class="mw-headline" id="Additional_Functions">Additional Functions</span></h2>
<p>When using TraCI there are some common tasks which are not covered by the traci library such as
</p>
<ul><li>Analyzing the road network</li>
<li>Parsing simulation outputs</li></ul>
<p>For this functionality it is recommended to use <a href="../Tools/Sumolib.html" title="Tools/Sumolib">Tools/Sumolib</a>
</p>
<h2><span class="mw-headline" id="Pitfalls_and_Solutions">Pitfalls and Solutions</span></h2>
<ul><li>Note that strings, if exchanged, have to be ASCII-encoded.</li>
<li>If you start sumo from within your python script using subprocess.Popen, be sure to call wait() on the resulting process object before quitting your script. You might loose output otherwise.</li></ul>
<h3><span class="mw-headline" id="Debugging_a_TraCI_session_on_Linux">Debugging a TraCI session on Linux</span></h3>
<p>Sometimes SUMO may crash while running a simulation with TraCI. 
The below steps make it simple to run sumo with traci in a debugger:
</p><p>1) add the option <i>--save-configuration</i> to your traci script:
</p>
<pre> traci.start([sumoBinary, '-c', 'run.sumocfg', '--save-simulation', 'debug.sumocfg'])
</pre>
<p>2) run your traci script. Instead of starting sumo it will just write the configuration with the chosen port but it will still try to connect repeatedly 
3) run 
</p>
<pre> gdb --args sumoD -c debug.sumocfg
</pre>
<h2><span class="mw-headline" id="Usage_Examples">Usage Examples</span></h2>
<h3><span class="mw-headline" id="Run_a_simulation_until_all_vehicles_have_arrived">Run a simulation until all vehicles have arrived</span></h3>
<pre>  while traci.simulation.getMinExpectedNumber() &gt; 0: 
      traci.simulationStep()
</pre>
<h3><span id="Add_trips_(incomplete_routes)_dynamically"></span><span class="mw-headline" id="Add_trips_.28incomplete_routes.29_dynamically">Add trips (incomplete routes) dynamically</span></h3>
<p>Define a route that consists of the start and destination edge:
</p>
<pre>   traci.route.add("trip", ["startEdge", "endEdge"])
</pre>
<p>Then add the vehicle with that route
</p>
<pre>   traci.vehicle.add("newVeh", "trip", typeID="reroutingType")
</pre>
<p>This will cause the vehicle to compute a new route from startEdge to endEdge according to the estimated travel times in the network at the time of departure. For details of this mechanism see <a href="../Demand/Automatic_Routing.html" title="Demand/Automatic Routing">Demand/Automatic_Routing</a>.
</p>
<h3><span class="mw-headline" id="coordinate_transformations">coordinate transformations</span></h3>
<pre> x, y = traci.vehicle.getPosition(vehID)
 lon, lat = traci.simulation.convertGeo(x, y)
 x2, y2 = traci.simulation.convertGeo(lon, lat, fromGeo=True)
</pre>
<pre> edgeID, lanePosition, laneIndex = traci.simulation.convertRoad(x3, y3)
 edgeID, lanePosition, laneIndex = traci.simulation.convertRoad(lon2, lat2, True)
</pre>
<h3><span class="mw-headline" id="Retrieve_the_timeLoss_for_all_vehicles_currently_in_the_network">Retrieve the timeLoss for all vehicles currently in the network</span></h3>
<p>import traci
import traci.constants as tc
junctionID = '...'
</p>
<ol><li>subscribe around an aribtrary junction with a sufficiently large radius to retrieve the speeds of all vehicles in every step</li></ol>
<p>traci.junction.subscribeContext(junctionID, tc.CMD_GET_VEHICLE_VARIABLE, 1000000, [tc.VAR_SPEED, tc.VAR_ALLOWED_SPEED])
stepLength = traci.simulation.getDeltaT()
while traci.simulation.getMinExpectedNumber() &gt; 0: 
</p>
<pre>   traci.simulationStep()
   scResults = traci.junction.getContextSubscriptionResults(junctionID)
   halting = 0
   if scResults:
       relSpeeds = [d[tc.VAR_SPEED] / d[tc.VAR_ALLOWED_SPEED] for d in scResults.values()]
       # compute values corresponding to summary-output
       running = len(relSpeeds)
       halting = len([1 for d in scResults.values() if d[tc.VAR_SPEED] &lt; 0.1])
       meanSpeedRelative = sum(relSpeeds) / running
       timeLoss = (1 - meanSpeedRelative) * running * stepLength
   print(traci.simulation.getTime(), timeLoss, halting)
</pre>
<p>traci.close()
</p>
<h2><span class="mw-headline" id="Further_Resources">Further Resources</span></h2>
<ul><li>The module <a href="../Simpla.html" title="Simpla">Simpla</a> provides a library for platooning functions that can be integrated with user client scripts.</li></ul>

<!-- 
NewPP limit report
Cached time: 20190414222613
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.016 seconds
Real time usage: 0.018 seconds
Preprocessor visited node count: 120/1000000
Preprocessor generated node count: 222/1000000
Post‐expand include size: 1294/2097152 bytes
Template argument size: 660/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 0/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    5.456      1 -total
 35.98%    1.963      2 Template:Option
 21.02%    1.147      2 Template:Caution
 17.43%    0.951      1 Template:SUMO
 17.13%    0.935      1 Template:Note
 16.84%    0.919      1 Template:DT_INT
-->

<!-- Saved in parser cache with key wiki:pcache:idhash:289-0!canonical and timestamp 20190414222613 and revision id 11951
 -->
</div></div>					</div><hr/><div id="lastmod"></div> </div>

    <div id="footer">
      <div>
        (c) 2011-2017, German Aerospace Center, Institute of
        Transportation Systems
      </div>

      <div>
        Layout based on <a href=
        "http://www.oswd.org/design/preview/id/3365">"Three
        Quarters"</a> by "SimplyGold"
      </div>
    </div>
  </div>
</body>
</html>
